<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Methodology behind localModel package â€¢ localModel</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- dalexverse --><link href="../dalexverse.css" rel="stylesheet">
<link href="../dalexverse-2.css" rel="stylesheet">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Methodology behind localModel package">
<meta property="og:description" content="localModel">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- google analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-5650686-14"></script><script>
 window.dataLayer = window.dataLayer || [];
 function gtag(){dataLayer.push(arguments);}
 gtag('js', new Date());

 gtag('config', 'UA-5650686-14');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="../index.html">localModel</a>
        <div class="info">
          <span class="partof">part of the <a href="https://github.com/ModelOriented/DrWhy">DrWhy.AI</a>
           developed by the <a href="https://mi2.mini.pw.edu.pl/">MI^2 DataLab</a> </span>
          <span class="version version-default">0.5</span>
        </div>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/classification_example.html">Explaining classification models with localModel package</a>
    </li>
    <li>
      <a href="../articles/localModel_methodology.html">Methodology behind localModel package</a>
    </li>
    <li>
      <a href="../articles/regression_example.html">Introduction to localModel package</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
        <li>
  <a href="https://github.com/ModelOriented/localModel/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="localModel_methodology_files/header-attrs-2.3/header-attrs.js"></script><script src="localModel_methodology_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Methodology behind localModel package</h1>
                        <h4 class="author">Mateusz Staniak</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ModelOriented/localModel/blob/master/vignettes/localModel_methodology.Rmd"><code>vignettes/localModel_methodology.Rmd</code></a></small>
      <div class="hidden name"><code>localModel_methodology.Rmd</code></div>

    </div>

    
    
<p><code>localModel</code> package is a variant of <a href="https://arxiv.org/abs/1602.04938">LIME</a>. As in LIME, the analysis consists of</p>
<ol style="list-style-type: decimal">
<li><p>Creating a new dataset <span class="math inline">\(X'\)</span> of <span class="math inline">\(m\)</span> observations that are similarly in some sense to the observation, for which we explain the prediction. This dataset is usually built in terms of new, interpretable features rather than original features. Size <span class="math inline">\(m\)</span> is a parameter to <code>individual_surrogate_model</code> function.</p></li>
<li><p>Fitting black box model to the new dataset. This step requires a transformation back to the original input space and is non-trivial for numerical data.</p></li>
<li><p>Fitting an explanation model (a glass box) to the outputs of black box model. Usually, LASSO regression is used to make sure that explanations are simple enough.</p></li>
</ol>
<p>In the next few paragraph, we will shortly describe how each of the steps is performed in <code>localModel</code>. All of them are implemented by the <code>individual_surrogate_model</code> function.</p>
<div id="sampling-for-local-exploration" class="section level2">
<h2 class="hasAnchor">
<a href="#sampling-for-local-exploration" class="anchor"></a>Sampling for local exploration</h2>
<p>Interpretable features are created in a way that depends on the type of the predictor.</p>
<ul>
<li><p>For categorical predictors, original dataset is used to obtain black box predictions. Then, the marginal relationship between the feature and response is modeled via decision tree with a single split to dichotomize the feature.</p></li>
<li><p>For numerical predictors, Ceteris Paribus profile is calculated and this marginal relationship is again dichotomized by a decision tree with maximum depth equal to 2.</p></li>
</ul>
<p>For both types of predictors, the intepretable input is an indicator variable equal to 1 for value of feature that falls into the group of levels or interval chosen by the decision tree. Other values of the predictor are treated as a single level, a baseline.</p>
<p>Sampling new observations is done by</p>
<ol style="list-style-type: decimal">
<li><p>Creating <span class="math inline">\(m\)</span> copies of the explained observation.</p></li>
<li>
<p>Iterating through these copies and in each step</p>
<ul>
<li>Choosing random number <span class="math inline">\(k\)</span> of feature to be switched to <em>baseline</em> value.</li>
<li>Choosing, which <span class="math inline">\(k\)</span> features will be changed.</li>
<li>When the <code>individual_surrogate_model</code> function is called with argument <code>sampling = "uniform"</code>, each of these values is changed to <em>baseline</em>, but when <code>sampling = "non-uniform"</code>, it is changed with probability equal to the proportion of <em>baseline</em> values in the original dataset.</li>
</ul>
</li>
</ol>
</div>
<div id="fitting-black-box-model" class="section level2">
<h2 class="hasAnchor">
<a href="#fitting-black-box-model" class="anchor"></a>Fitting black box model</h2>
<p>Fitting the black box model to new observation requires transforming them into the original feature space. In <code>localModel</code>, this is done the following way. The original dataset is transformed into the interpretable feature space. Based on this transformation, we know which values of each feature are categorized as <em>baseline</em> and which as the explained value. Then, for each simulated observation, and for each feature, we pick a random value of this feature from the original dataset that corresponds either to the <em>baseline</em> group or the explained value. Black box model is fitted to these observations.</p>
</div>
<div id="fitting-the-explanation-model" class="section level2">
<h2 class="hasAnchor">
<a href="#fitting-the-explanation-model" class="anchor"></a>Fitting the explanation model</h2>
<p>LASSO model with penalty chosen via cross-validation is used in <code>localModel</code> package. Optionally, observation can be weighted according to their distance from the explained observation in the space of interpretable features. Weighting is controlled via <code>kernel</code> parameter to <code>individual_surrogate_model</code>.</p>
<p>The resulting model can be plotted using generic <code>plot</code> function. Models can be compared by passing several explainer object to <code>plot</code>.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Mateusz Staniak, Przemyslaw Biecek.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
